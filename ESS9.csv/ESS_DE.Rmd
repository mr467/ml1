---
title: "European Survey - What is the political sentiment in German speaking Countries Before Covid?"
author: "Milica Pajkic and Marco Rieder"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 3
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE
)
```

# Getting the Data and installing libraries

```{r, include=FALSE}
if (!require("naniar")) install.packages("naniar", dependencies=TRUE)
library(lubridate)
library(multcomp)
library(dplyr)
library(readr)
library(data.table)
library(tidyverse)
library(naniar)
```

```{r}

ess9 <- read_csv("ESS9.csv")

unique(ess9$name)
unique(ess9$gndr)
unique(ess9$cntry)
```

```{r making subsets of the whole dataset to only german speaking countries}
ess9_de <- subset(ess9, cntry == "DE", select =dweight:domain)
ess9_ch <- subset(ess9, cntry == "CH", select =dweight:domain)
ess9_at <- subset(ess9, cntry == "AT", select =dweight:domain)
```

# 1. Introduction

# 2. Descriptive Statistics

```{r}
glimpse(ess9_de)
```

```{r }
summary(ess9_de$nwspol)
sum(is.na(ess9_de$nwspol))
```

```{r echo=FALSE}
summary(ess9_de$gndr)
sum(is.na(ess9_de$gndr))
typeof(ess9_de$nwspol)

```

```{r}
ggplot(ess9_de, aes(nwspol, 1)) +
  geom_bar(stat = "identity") + 
  xlim(c(0, 200))
```

### **Was muss man alles fÃ¼r eine deskriptive Analyse machen?**

```{r lineare Regression}
typeof(ess9_de$eduade3)
summary(ess9_de$eduade3)
sum(is.na(ess9_de$eduade3))

```

#### Cleaning of the data

##### linear Model

```{r recode Variable resp. clean}
#NEWS Politics time recoded
ess9_de$nwspol_na <- ess9_de$nwspol
ess9_de["nwspol_na"][ess9_de["nwspol_na"] >= 7777] <- NA
#Educationlevel  recoding
ess9_de$eduade3.na <- ess9_de$eduade3
ess9_de["eduade3.na"][ess9_de["eduade3.na"] >= 5555] <- NA
#Added "Other" also under NA bc we cannot explain what other is

#recode the age variable
ess9_de$agea.na <- ess9_de$agea
ess9_de["agea.na"][ess9_de["agea.na"] >= 140] <- NA

#record the gender variable
ess9_de$gndr.na <- ess9_de$gndr
ess9_de["gndr.na"][ess9_de["gndr.na"] >= 9] <- NA
ess9_de$gndr.fac <- factor(ess9_de$gndr.na)

#clean the satisfaction with government
ess9_de$stfdem.na <- ess9_de$stfdem
ess9_de["stfdem.na"][ess9_de["stfdem.na"] > 10] <- NA

#clean Boycott certain products
ess9_de$bctprd.na <- ess9_de$bctprd
ess9_de["bctprd.na"][ess9_de["bctprd.na"] > 2] <- NA
ess9_de$boycott.fac <- factor(ess9_de$bctprd.na)

#clean left-right scale
ess9_de$polscale.na <- ess9_de$lrscale
ess9_de["polscale.na"][ess9_de["polscale.na"] > 10] <- NA
```

```{r checking}
summary(ess9_de$nwspol)
summary(ess9_de$nwspol_na)
sum(is.na(ess9_de$nwspol_na))
summary(ess9_de$eduade3)
summary(ess9_de$eduade3.na)
summary(as.factor(ess9_de$eduade3.na))

summary(ess9_de$agea)
summary(ess9_de$agea.na)

summary(ess9_de$gndr.fac)
sum(is.na(ess9_de$gndr.na))
summary(as.factor(ess9_de$stfdem.na))
sum(is.na(ess9_de$stfdem.na))
sum(is.na(ess9_de$bctprd.na))

sum(is.na(ess9_de$polscale.na))
```

```{r}
boxplot(ess9_de$nwspol_na, outline = FALSE)
```

```{r}
ggplot(ess9_de, aes(eduade3.na, nwspol_na)) + 
  geom_point() +
  ylim(0, 500)
```

```{r}
ggplot(ess9_de, aes(agea.na, nwspol_na)) + 
  geom_point() +
  ylim(0, 500)
```

```{r}
boxplot(ess9_de$nwspol_na, ess9_de$gndr.fac, outline = FALSE)
```

### wieso ist gender = 2 so komisch?

##### Binomial Model

```{r}
summary(ess9_de$vote)
#1 = yes
#2 = no
#elligible
ess9_de$vote_na <- ess9_de$nwspol
ess9_de["vote_na"][ess9_de["vote_na"] >= 4] <- NA
summary(ess9_de$vote_na)
typeof(ess9_de$vote)

```

```{r}
ess9_de$pstplonl_f <- as.factor(ifelse(ess9_de$pstplonl <2, 'Y', 'Nein'))
is.na(ess9_de$pstplonl_f)[8] <- TRUE
summary(ess9_de$pstplonl_f)
typeof(ess9_de$pstplonl_f)
```

# 3. Models

## 3.1 Linear Model

How much politics are you watching = DV\
education level by years = IV\
happy with government = IV\
Gender = IV\
Age = IV

```{r linear Regression}
lm_news.1 <- lm(nwspol_na ~ eduade3.na, data = ess9_de)
summary(lm_news.1)
```

```{r}
coef(lm_news.1)
```

```{r}
summary(lm_news.1)$coefficients
```

```{r}
confint(lm_news.1)
```

```{r}
plot(nwspol_na ~ eduade3.na, data = ess9_de, main = "Minutes spent on Political News")
abline(lm_news.1)
```

```{r fitted values}
fit_lm_news.1 <- fitted(lm_news.1)
str(fit_lm_news.1)
head(fit_lm_news.1)
```

```{r fitted values plot lm1}
plot(nwspol_na ~ eduade3.na, data = ess9_de, 
     main = "Minutes spent on Political News", 
     col = "darkgrey")
points(fit_lm_news.1 ~ eduade3.na, 
       col = "purple", 
       pch = 19, 
       data = ess9_de)
abline(lm_news.1, col = "black")
```

```{r}
lm_news.2 <- lm(nwspol_na ~ eduade3.na + agea.na, data = ess9_de)
summary(lm_news.2)
```

```{r}
coef(lm_news.2)
```

```{r}
summary(lm_news.2)$coefficients
```

```{r}
plot(nwspol_na ~ eduade3.na + agea.na, data = ess9_de, main = "Minutes spent on Political News")
abline(lm_news.2)
```

```{r}
lm_news.3 <- lm(nwspol_na ~ eduade3.na + agea.na + gndr.fac, data = ess9_de)
summary(lm_news.3)
```

## 3.2 GLM Poisson

```{r}
glmP_news <- glm(nwspol ~ edu,
family = "poisson", ## we specify the distribution!
data = ess9_ch)
```

## 3.3 GLM Binominal

```{r}
gl
```

## 3.3 GLM Binominal

## 3.4 GAM

## 3.5 Neural Network

## 3.6 Support Vector Machine
