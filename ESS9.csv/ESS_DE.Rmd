---
title: "European Survey - What is the political sentiment in German speaking Countries Before Covid?"
author: "Milica Pajkic and Marco Rieder"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 3
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE
)
```

# Getting the Data and installing libraries

```{r, include=FALSE}
library(lubridate)
library(multcomp)
library(dplyr)
library(readr)
library(data.table)
library(tidyverse)
library(naniar)
library(neuralnet)
library(nnet)
library(caret)
library(gamlss.add)
library(ggplot2)
```

```{r}

ess9 <- read_csv("ESS9.csv")

unique(ess9$name)
unique(ess9$gndr)
unique(ess9$cntry)
```

```{r making subsets of the whole dataset to only german speaking countries}
ess9_de <- subset(ess9, cntry == "DE", select =dweight:domain)
ess9_ch <- subset(ess9, cntry == "CH", select =dweight:domain)
ess9_at <- subset(ess9, cntry == "AT", select =dweight:domain)
```

# 1. Introduction

# 2. Descriptive Statistics

```{r }
summary(ess9_de$nwspol)
sum(is.na(ess9_de$nwspol))
```

```{r echo=FALSE}
summary(ess9_de$gndr)
sum(is.na(ess9_de$gndr))
typeof(ess9_de$nwspol)
```

```{r}
ggplot(ess9_de, aes(nwspol, 1)) +
  geom_bar(stat = "identity") + 
  xlim(c(0, 200))
```

```{r}
boxplot(ess9_de$nwspol, outline=FALSE)
```

### **Was muss man alles fÃ¼r eine deskriptive Analyse machen?**

```{r lineare Regression}
typeof(ess9_de$eduade3)
summary(ess9_de$eduade3)
sum(is.na(ess9_de$eduade3))
```

# 3. Models

## 3.1 Linear Model

How much politics are you watching = DV\
education level by years = IV\
happy with government = IV\
Gender = IV\
Age = IV


```{r linear Regression}
lm_news.1 <- lm(nwspol ~ eduade3, data = ess9_de)
summary(lm_news.1)
```

## 3.2 GLM Poisson

```{r}
# Setting NA values correct for the used parameters replace with NA replace function from naniar package

ess9_poisson <- ess9 %>%
  replace_with_na(replace = list(nwspol =
                                   c(6666, 7777, 8888, 9999),
                                 eduyrs = c(77, 88, 99),
                                 stfeco = c(77, 88, 99),
                                 stfgov = c(77, 88, 99),
                                 stfdem = c(77, 88, 99),
                                 gndr = 9,
                                 agea = 999,
                                 rlgdgr = c(77, 88, 99)
                                 ))

#testing if change has worked and how many NA we have - for four examples

sum(is.na(ess9_poisson$nwspol))
sum(is.na(ess9_poisson$eduyrs))
sum(is.na(ess9_poisson$stfgov))
sum(is.na(ess9_poisson$agea))

# drop NA for the columns used for the poisson model
ess9_poisson <- ess9_poisson %>% drop_na((c(
  nwspol,eduyrs, stfeco, stfgov, stfdem, gndr, agea, rlgdgr)))


# fit the model and use 5 parameter
glmP_news <- glm(nwspol ~ eduyrs + stfeco + stfgov + stfdem + gndr + agea + rlgdgr,
                 family = "poisson", ## we specify the distribution!
                 data = ess9_poisson)

summary(glmP_news)


set.seed(2)
sim.data.ess9.Poisson <- simulate(glmP_news)
##
NROW(sim.data.ess9.Poisson)
head(sim.data.ess9.Poisson)


ggplot(mapping = aes(y = sim.data.ess9.Poisson$sim_1,
                     x = as.factor(ess9_poisson$gndr))) +
  geom_boxplot() +
  geom_hline(yintercept = 0) +
  ylab("simulated media consumption \n(assuming Poisson dist)") +
  xlab("Gender")
```
### 3.2.1 GLM Quasi-Poisson


```{r}

glmQ_news <- glm(nwspol ~ eduyrs + stfeco + stfgov + stfdem + gndr + agea + rlgdgr,
                 family = "quasipoisson", ## we specify the distribution!
                 data = ess9)
summary(glmQ_news)



```


<<<<<<< HEAD:ESS9.csv/ESS_DE.Rmd
## 3.3 GLM Binominal
=======
```{r}

```


## 3.3 GLM Binominal 
>>>>>>> d33abb64bd4520b2c184cf8af74b866bfe227af9:ESS9.csv/rfile/ESS_DE.Rmd

## 3.4 GAM

## 3.5 Neural Network

```{r message=FALSE, warning=FALSE}
max <- apply(ess9, 2, max)
min <- apply(ess9, 2, min)
```


```{r message=FALSE, warning=FALSE}
str(ess9)
#ess9_scaled <- as.data.frame(scale(ess9, center = min, scale = max - min))

test_ess9 <-scale(ess9, center = min, scale = max - min)


set.seed(42)
tuGrid <- expand.grid(.layer1=c(1:4), .layer2=c(0,2), .layer3=c(0))

trCtrl <- trainControl(
  method = 'repeatedcv', 
  number = 5, 
  repeats = 10, 
  returnResamp = 'final'
)

models <- train(
  x = ess9 %>% dplyr::select(-nwspol),
  y = ess9_scaled %>% pull(nwspol),
  method = 'neuralnet', metric = 'RMSE', 
  linear.output = TRUE,
  # be careful, does only work on x!
  preProcess = c('center', 'scale'),
  tuneGrid = tuGrid,
  trControl = trCtrl
)
```

```{r}
plot(models)
```
and extract the best model

```{r}
plot(models$finalModel)
```


## 3.6 Support Vector Machine
